<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.roommake.product.mapper.ProductMapper">

<!--    <resultMap type="com.roommake.product.vo.Product" id="ProductResultMap">-->
<!--        <id column="product_id" property="id" />-->
<!--        <result column="product_name" property="name"/>-->
<!--        <result column="product_content" property="content"/>-->
<!--        <result column="product_status_yn" property="statusYn"/>-->
<!--        <result column="product_create_date" property="createDate"/>-->
<!--        <result column="product_update_date" property="updateDate"/>-->
<!--        <result column="product_delete_date" property="deleteDate"/>-->
<!--        <result column="product_delete_yn" property="deleteYn"/>-->
<!--        <result column="product_price" property="price"/>-->
<!--        <result column="product_discount" property="discount"/>-->
<!--        <result column="parents_product_id" property="parentsId"/>-->
<!--        <association property="product_category" javaType="com.roommake.product.vo.ProductCategory">-->
<!--            <id column="product_category_id" property="id" />-->
<!--            <result column="product_category_name" property="name" />-->
<!--        </association>-->
<!--        <collection property="prod_tag_category" ofType="com.roommake.product.vo.ProductTagCategory">-->
<!--            <id column="product_tag_category" property="id"/>-->
<!--            <result column="product_tag_category_name" property="name"/>-->
<!--        </collection>-->
<!--    </resultMap>-->

    <select id="getAllProducts" resultType="com.roommake.product.vo.Product">
        select
            product_id              as id,
            product_name            as name,
            product_content         as content,
            product_status_yn       as statusYn,
            product_create_date     as createDate,
            product_update_date     as updateDate,
            product_delete_date     as deleteDate,
            product_delete_yn       as deleteYn,
            product_price           as price,
            product_discount        as discount,
            category_id             as categoryId,
            category_name           as category_name,
            parents_product_id      as parentsId
        from
            product
        order by
            product_id asc
    </select>
    <!--상위을 사진리스트에 표현 -->
    <select id="getProducts" resultType="com.roommake.admin.product.dto.ProductListDto">
        select
            A.product_id              as id,
            A.product_name            as name,
            A.product_content         as content,
            A.product_status_yn       as statusYn,
            A.product_create_date     as createDate,
            A.product_update_date     as updateDate,
            A.product_delete_date     as deleteDate,
            A.product_delete_yn       as deleteYn,
            A.product_price           as price,
            A.product_discount        as discount,
            A.category_id             as categoryId,
            A.parents_product_id      as parentsId,
            (select product_image_name from product_image x where x.product_id = A.product_id  order by x.product_image_id asc limit 1) imageName,
            C.product_category_id     as category_id,
            C.product_category_name   as category_name
        from product A,product_category C
        where A.category_id=C.product_category_id;
    </select>


    <select id="getProductsById" parameterType="int" resultType="com.roommake.product.vo.Product">
        select
            product_id              as id,
            product_name            as name,
            product_content         as content,
            product_status_yn       as statusYn,
            product_create_date     as createDate,
            product_update_date     as updateDate,
            product_delete_date     as deleteDate,
            product_delete_yn       as deleteYn,
            product_price           as price,
            product_discount        as discount,
            category_id             as categoryId,
            parents_product_id      as parentsId
        from
            product
        where
            category_id = #{value}
        order by
            product_id asc
    </select>

<!--    <select id="getProductsById" parameterType="int" resultMap="ProductResultMap">-->
<!--        select-->
<!--            *-->
<!--        from-->
<!--            product a, product_tag b, prod_tag_category c-->
<!--        where-->
<!--            category_id = #{value},-->
<!--            a.product_id = b.product_id,-->
<!--            b.prod_tag_category_id = c.prod_tag_category_id-->
<!--        order by-->
<!--            product_id asc-->
<!--    </select>-->

    <select id="getAllProductTags" resultType="com.roommake.product.vo.ProductTag">
        select
            product_id              as product,
            prod_tag_category_id    as category
        from
            product_tag
    </select>

    <select id="getProductById" parameterType="int" resultType="com.roommake.product.vo.Product">
        select
            product_id              as id,
            product_name            as name,
            product_content         as content,
            product_status_yn       as statusYn,
            product_create_date     as createDate,
            product_update_date     as updateDate,
            product_delete_date     as deleteDate,
            product_delete_yn       as deleteYn,
            product_price           as price,
            product_discount        as discount,
            category_id             as categoryId,
            parents_product_id      as parentsId
        from
            product
        where
            product_id = #{id}
    </select>

    <select id="getProductDetailById" parameterType="int" resultType="com.roommake.product.vo.ProductDetail">
        select
            product_detail_id           as id,
            product_detail_unique_id    as uniqueId,
            product_detail_size         as size,
            product_detail_color        as color,
            product_detail_stock        as stock,
            product_id                  as product
        from
            product_detail
        where
            product_id = #{value}
    </select>

    <select id="getProductMainCategories" resultType="com.roommake.product.vo.ProductCategory">
        select
            product_category_id             as id,
            product_category_name           as name,
            parents_product_category_id     as parentsId
        from
            product_category
        where
            parents_product_category_id is null;
    </select>

    <select id="getProductSubCategories" parameterType="int" resultType="com.roommake.product.vo.ProductCategory">
        select
            product_category_id             as id,
            product_category_name           as name,
            parents_product_category_id     as parentsId
        from
            product_category
        where
            parents_product_category_id = #{value}
    </select>

    <insert id="createCart" parameterType="com.roommake.cart.vo.Cart">
        insert into cart
            (product_id, user_id, cart_item_amount, product_detail_id)
        values
            (#{product.id},#{user.id},#{amount},#{productDetail.id})
    </insert>

    <insert id="insertProduct" parameterType="com.roommake.product.vo.Product">
        <selectKey keyProperty="id" order="AFTER" resultType="int">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into product
            (product_name, product_content, product_price, product_discount, category_id)
        values
            (#{name}, #{content}, #{price}, #{discount}, #{category.id})
    </insert>

    <insert id="insertProductImage" parameterType="com.roommake.product.vo.ProductImage">
        insert into product_image(product_id, product_image_name)
        values(#{productId.id}, #{name})
    </insert>

    <update id="modifyProduct" parameterType="com.roommake.product.vo.Product">
        update product
        set
             product_name = #{name},
             product_price = #{price},
             product_update_date = #{updateDate},
             product_discount = #{discount},
             product_content = #{content}
        where
            product_id = #{id}
    </update>

    <select id="getProductImages"  parameterType="int" resultType="com.roommake.product.vo.ProductImage">
        select
            product_image_id        as id,
            product_image_name      as name
        from
            product_image
        where
            product_id = #{id}
    </select>
    <insert id="insertProductDetail"  parameterType="com.roommake.product.vo.ProductDetail">
        insert into product_detail
        (product_detail_unique_id, product_detail_size,product_detail_color , product_detail_stock,product_id)
        values
        (#{uniqueId}, #{size}, #{color}, #{stock},#{id})
    </insert>

    <select id="getCategoryId"  parameterType="int" resultType="int">
        select
            category_id
        from
            product
        where
            product_id = #{id}
    </select>

</mapper>